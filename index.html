<!DOCTYPE html>
<html>
<head>
  <title>Redirecting</title>
  <script src="https://statics.teams.cdn.office.net/sdk/v1.10.0/js/MicrosoftTeams.min.js"></script>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
</head>
<body>
  <!--
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      microsoftTeams.initialize();
      const FinalHubDeepLinkUrl = "https://teams.microsoft.com/l/entity/2a527703-1f6f-4559-a332-d8a7d288cd88/_djb2_msteams_prefix_1573395180?context=%7B%22channelId%22%3A%2219%3ARCrLj4NC_rswzh6aSowcowBlOeByFKkR21Qs9U75_e01%40thread.tacv2%22%7D&tenantId=2965b672-227f-448f-bbb2-cb113e23ac9a";
      const GeneralChannelDeepLinkUrl = "https://teams.microsoft.com/l/channel/19%3ARCrLj4NC_rswzh6aSowcowBlOeByFKkR21Qs9U75_e01%40thread.tacv2/General?groupId=f7c81ca2-e9f0-4809-822c-05edc19efab9&tenantId=2965b672-227f-448f-bbb2-cb113e23ac9a";

      // On first load, push an extra history state so we can detect a "pop"
      if (!sessionStorage.getItem("teamsRedirectInProgress")) {
        sessionStorage.setItem("teamsRedirectInProgress", "true");
        // Push state so that going "back" triggers a popstate event
        history.pushState({ redirected: true }, document.title, "#redirect");
        microsoftTeams.executeDeepLink(FinalHubDeepLinkUrl);
      }

      // If the user returns to this page by pressing back, popstate fires:
      window.addEventListener("popstate", (event) => {
        // We can check event.state if needed
        if (event.state && event.state.redirected) {
          // Immediately go back once more
          microsoftTeams.executeDeepLink(GeneralChannelDeepLinkUrl);

        }
      });
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      microsoftTeams.initialize();

      // Your deep link to the Teams channel, tab, or app
      const FinalHubDeepLinkUrl = "https://teams.microsoft.com/l/entity/2a527703-1f6f-4559-a332-d8a7d288cd88/_djb2_msteams_prefix_1573395180?context=%7B%22channelId%22%3A%2219%3ARCrLj4NC_rswzh6aSowcowBlOeByFKkR21Qs9U75_e01%40thread.tacv2%22%7D&tenantId=2965b672-227f-448f-bbb2-cb113e23ac9a";
      const GeneralChannelDeepLinkUrl = "https://teams.microsoft.com/l/channel/19%3ARCrLj4NC_rswzh6aSowcowBlOeByFKkR21Qs9U75_e01%40thread.tacv2/General?groupId=f7c81ca2-e9f0-4809-822c-05edc19efab9&tenantId=2965b672-227f-448f-bbb2-cb113e23ac9a";

      // Check if we've already redirected once in this session
      if (!sessionStorage.getItem("alreadyRedirected")) {
        // First time on this page => set marker and execute the deep link
        sessionStorage.setItem("alreadyRedirected", "true");
        microsoftTeams.executeDeepLink(FinalHubDeepLinkUrl);
      } else {
          microsoftTeams.executeDeepLink(GeneralChannelDeepLinkUrl);
          sessionStorage.setItem("alreadyRedirected", "false");
        }
    });
  </script>
  -->
  <script>
      // The pageshow event (with event.persisted === true) indicates a back/forward cache load.
    window.addEventListener("pageshow", (event) => {
      alert('event fired');
      microsoftTeams.initialize();
      const ALREADY_REDIRECTED_KEY = "alreadyRedirected";
      // Your deep link to the Teams channel, tab, or app
      const FinalHubDeepLinkUrl = "https://teams.microsoft.com/l/entity/2a527703-1f6f-4559-a332-d8a7d288cd88/_djb2_msteams_prefix_1573395180?context=%7B%22channelId%22%3A%2219%3ARCrLj4NC_rswzh6aSowcowBlOeByFKkR21Qs9U75_e01%40thread.tacv2%22%7D&tenantId=2965b672-227f-448f-bbb2-cb113e23ac9a";
      const GeneralChannelDeepLinkUrl = "https://teams.microsoft.com/l/channel/19%3ARCrLj4NC_rswzh6aSowcowBlOeByFKkR21Qs9U75_e01%40thread.tacv2/General?groupId=f7c81ca2-e9f0-4809-822c-05edc19efab9&tenantId=2965b672-227f-448f-bbb2-cb113e23ac9a";
      // If we've already redirected once in this session, or if the page is loaded from cache
      // we immediately go back again.
      const alreadyRedirected = !!sessionStorage.getItem(ALREADY_REDIRECTED_KEY);
      if (alreadyRedirected || event.persisted) {
        alert('it true');
        // If we want to push them further back, call history.back()
        sessionStorage.setItem("alreadyRedirected", "false");
        microsoftTeams.executeDeepLink(GeneralChannelDeepLinkUrl);
      } else {
        alert('if false');
        // If it's a fresh load, do the redirect
        sessionStorage.setItem("alreadyRedirected", "true");
        microsoftTeams.executeDeepLink(FinalHubDeepLinkUrl);
      }
    });
 </script>
</body>
</html>
